<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../favicon.ico">

    <title>View report</title>

    <link href="assets/bootstrap-3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/chartist-0.9.8/css/chartist.min.css" rel="stylesheet">

    <script src="assets/jquery-3.1.1/js/jquery-3.1.1.min.js" charset="utf-8"></script>
    <script src="assets/chartist-0.9.8/js/chartist.min.js" charset="utf-8"></script>
    <script src="assets/underscore-1.8.3/js/underscore-min.js" charset="utf-8"></script>
    <script src="assets/jquery.jsontotable-1.1.3/js/jquery.jsontotable.min.js" charset="utf-8"></script>

    <link href="style.css" rel="stylesheet">
</head>

<body>
    <div class="container">
        <div class="ct-chart ct-octave"></div>
        <div id="jsontotable" class="jsontotable"></div>
    </div>
</body>

<style>
.ct-chart .ct-bar {
    stroke-width: 60px
}
</style>

<script>
    $.ajax({
        url: 'http://localhost:3000/api/report/overall',
        type: 'GET',
        contentType: 'application/json',
        data: {},
        success: function(data) {
            var locations  = _.map(data, function(row) { return row.location; });
            var values     = _.map(data, function(row) { return row.scores; });
            var transposed = _.zip.apply(_, values)

            var chartData = {
              labels: locations,
              series: transposed
            };

            var options = {
              stackBars: true,
              onlyInteger: true
            };

            new Chartist.Bar('.ct-chart', chartData, options);

            var tableData = data.map(function (row) { return [ row.location, row.overallScores, row.overallBooks, row.books[0],row.books[1],row.books[2],row.books[3] ] })
            tableData.unshift(["Локация", "Очки", "Книги", "МБ", "Б", "С", "М"]);
            //tableData = _.zip(tableData, [1,2,3,4,5]);
            console.log(tableData);
            $.jsontotable(tableData, { id: '#jsontotable', className: 'table table-hover' });
        }
    });

    /*var data = {
        labels: ['W1', 'W2', 'W3', 'W4', 'W5', 'W6', 'W7', 'W8', 'W9', 'W10'],
        series: [
            [1, 2, 4, 8, 6, -2, -1, -4, -6, -2]
        ]
    };

    var options = {
        high: 10,
        low: -10,
        axisX: {
            labelInterpolationFnc: function(value, index) {
                return index % 2 === 0 ? value : null;
            }
        }
    };

    new Chartist.Bar('.ct-chart', data, options);*/
</script>

</html>
