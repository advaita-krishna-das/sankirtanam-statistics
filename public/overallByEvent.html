<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../favicon.ico">

    <title>По событию</title>

    <link href="assets/bootstrap-3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/chartist-0.9.8/css/chartist.min.css" rel="stylesheet">

    <script src="assets/jquery-3.1.1/js/jquery-3.1.1.min.js" charset="utf-8"></script>
    <script src="assets/chartist-0.9.8/js/chartist.min.js" charset="utf-8"></script>
    <script src="assets/underscore-1.8.3/js/underscore-min.js" charset="utf-8"></script>
    <script src="assets/jquery.jsontotable-1.1.3/js/jquery.jsontotable.min.js" charset="utf-8"></script>

    <link href="style.css" rel="stylesheet">
</head>

<body>
    <div class="container">
        <h1 id="title"></h1>
        <div class="ct-chart ct-octave"></div>
        <div id="jsontotable" class="jsontotable"></div>
    </div>
</body>

<style>
    .ct-chart .ct-bar {
        stroke-width: 60px
    }
</style>

<script>
    function getQueryVariable(variable) {
        var query = window.location.search.substring(1);
        var vars = query.split("&");
        for (var i = 0; i < vars.length; i++) {
            var pair = vars[i].split("=");
            if (pair[0] == variable) {
                return pair[1];
            }
        }
        return (false);
    }

    var reportName = getQueryVariable("event");

    $.ajax({
        url: 'http://localhost:3000/api/report/byEvent?event=' + reportName,
        type: 'GET',
        contentType: 'application/json',
        data: {},
        success: function(data) {
            var locations = _.map(data, function(row) {
                return row.location;
            });
            var values = _.map(data, function(row) {
                return row.scores;
            });
            values = _.zip.apply(_, values);

            new Chartist.Bar('.ct-chart', {
                labels: locations,
                series: values
            }, {
                stackBars: true,
                onlyInteger: true
            });

            var tableData = data.map(function(row) {
                return [
                    row.location, row.overallScores, row.overallBooks, row.books[0],
                    row.books[1], row.books[2], row.books[3]
                ]
            })

            tableData.unshift(["Локация", "Очки", "Книги", "МБ", "Б", "С", "М"]);
            $.jsontotable(tableData, {
                id: '#jsontotable',
                className: 'table table-hover'
            });

            $("#title").html(decodeURIComponent(reportName));
        }
    });
</script>

</html>
